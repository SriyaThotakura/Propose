<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feral Agent Computational Framework</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0A1628;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: #FFFFFF;
        }
        
        h1 {
            color: #FF6B9D;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #1B9BD8;
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        #chart {
            background: #0D1F3C;
            border-radius: 10px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(255, 107, 157, 0.3);
            overflow-x: auto;
        }
        
        .link-line {
            fill: none;
            stroke-width: 2px;
            opacity: 0.5;
            transition: opacity 0.3s, stroke-width 0.3s;
        }
        
        .link-line:hover {
            opacity: 1;
            stroke-width: 4px;
        }
        
        .node-circle {
            stroke: #0A1628;
            stroke-width: 3px;
            transition: r 0.3s;
            cursor: pointer;
        }
        
        .node-circle:hover {
            r: 14;
        }
        
        .node-label {
            font-size: 11px;
            font-weight: 600;
            fill: #FFFFFF;
            text-shadow: 0 0 4px #0A1628, 0 0 4px #0A1628;
            pointer-events: none;
            text-anchor: middle;
        }
        
        .layer-label {
            font-size: 13px;
            font-weight: 700;
            fill: #FF6B9D;
            text-anchor: middle;
        }
        
        .legend {
            margin-top: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            max-width: 1200px;
            width: 100%;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #0D1F3C;
            padding: 10px;
            border-radius: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            border: 2px solid #0A1628;
        }
        
        .legend-text {
            font-size: 12px;
            color: #FFFFFF;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(13, 31, 60, 0.95);
            color: #FFFFFF;
            padding: 10px;
            border-radius: 5px;
            border: 2px solid #FF6B9D;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            max-width: 250px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <h1>Feral Agent Computational Framework</h1>
    <p class="subtitle">Hierarchical Flow Diagram: Left-to-Right System Architecture</p>
    
    <div id="chart"></div>
    
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background: #1B9BD8;"></div>
            <div class="legend-text">Input/Logic Layers</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #9D4EDD;"></div>
            <div class="legend-text">Data Sources</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FFB84D;"></div>
            <div class="legend-text">Core Algorithms</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF6B9D;"></div>
            <div class="legend-text">Processing Functions</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #B490FF;"></div>
            <div class="legend-text">Visualization Outputs</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF8C42;"></div>
            <div class="legend-text">Alert Systems</div>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>

    <script>
        const width = 1400;
        const height = 800;
        const margin = { top: 50, right: 100, bottom: 50, left: 100 };

        const nodes = [
            // Layer 0
            { id: 0, name: "Framework\nCore", color: "#0A1628", layer: 0 },
            { id: 16, name: "Perma-\nComputing", color: "#1B9BD8", layer: 0 },
            
            // Layer 1
            { id: 1, name: "Input\nLayer", color: "#1B9BD8", layer: 1 },
            
            // Layer 2
            { id: 2, name: "Historical\nData", color: "#9D4EDD", layer: 2 },
            { id: 11, name: "Real-Time\nData", color: "#9D4EDD", layer: 2 },
            
            // Layer 3
            { id: 3, name: "ABM\nCore", color: "#1B9BD8", layer: 3 },
            { id: 12, name: "Forensic\nAlert", color: "#1B9BD8", layer: 3 },
            
            // Layer 4
            { id: 4, name: "Ternary\nLogic", color: "#FFB84D", layer: 4 },
            { id: 5, name: "Agent\nMovement", color: "#9D4EDD", layer: 4 },
            { id: 13, name: "Threshold\nCheck", color: "#FFB84D", layer: 4 },
            
            // Layer 5
            { id: 6, name: "Intervention\nDamping", color: "#FF6B9D", layer: 5 },
            { id: 14, name: "Cron\nSchedule", color: "#9D4EDD", layer: 5 },
            
            // Layer 6
            { id: 7, name: "Final\nPositions", color: "#1B9BD8", layer: 6 },
            { id: 15, name: "Alert\nOutput", color: "#FF8C42", layer: 6 },
            
            // Layer 7
            { id: 8, name: "Visualization", color: "#1B9BD8", layer: 7 },
            
            // Layer 8
            { id: 9, name: "KDE\nFunction", color: "#FF6B9D", layer: 8 },
            
            // Layer 9
            { id: 10, name: "Iso\nSurface", color: "#B490FF", layer: 9 }
        ];

        const links = [
            { source: 0, target: 1, value: 8 },
            { source: 16, target: 1, value: 4 },
            { source: 1, target: 2, value: 6 },
            { source: 1, target: 11, value: 6 },
            { source: 2, target: 3, value: 7 },
            { source: 3, target: 4, value: 5 },
            { source: 4, target: 5, value: 5 },
            { source: 5, target: 6, value: 5 },
            { source: 6, target: 7, value: 5 },
            { source: 7, target: 8, value: 6 },
            { source: 8, target: 9, value: 5 },
            { source: 9, target: 10, value: 5 },
            { source: 11, target: 12, value: 6 },
            { source: 12, target: 13, value: 5 },
            { source: 13, target: 14, value: 5 },
            { source: 14, target: 15, value: 5 }
        ];

        // Group nodes by layer
        const layers = d3.group(nodes, d => d.layer);
        const numLayers = Math.max(...nodes.map(d => d.layer)) + 1;
        
        // Calculate positions
        const layerWidth = (width - margin.left - margin.right) / (numLayers - 1);
        
        layers.forEach((layerNodes, layer) => {
            const layerHeight = height - margin.top - margin.bottom;
            const nodeSpacing = layerHeight / (layerNodes.length + 1);
            
            layerNodes.forEach((node, i) => {
                node.x = margin.left + layer * layerWidth;
                node.y = margin.top + (i + 1) * nodeSpacing;
            });
        });

        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .attr("viewBox", [0, 0, width, height]);

        const tooltip = d3.select("#tooltip");

        // Add layer labels
        svg.append("g")
            .selectAll("text")
            .data(d3.range(numLayers))
            .join("text")
            .attr("class", "layer-label")
            .attr("x", d => margin.left + d * layerWidth)
            .attr("y", 25)
            .text(d => `Layer ${d}`);

        // Draw links as curved lines
        const link = svg.append("g")
            .selectAll("path")
            .data(links)
            .join("path")
            .attr("class", "link-line")
            .attr("stroke", d => {
                const sourceNode = nodes.find(n => n.id === d.source);
                const targetNode = nodes.find(n => n.id === d.target);
                return d3.interpolateRgb(sourceNode.color, targetNode.color)(0.5);
            })
            .attr("d", d => {
                const source = nodes.find(n => n.id === d.source);
                const target = nodes.find(n => n.id === d.target);
                
                const dx = target.x - source.x;
                const dy = target.y - source.y;
                
                // Create smooth bezier curve
                const controlPointX = source.x + dx * 0.5;
                const controlPointY = source.y + dy * 0.5;
                
                return `M${source.x},${source.y} Q${controlPointX},${controlPointY} ${target.x},${target.y}`;
            })
            .on("mouseover", function(event, d) {
                d3.select(this)
                    .attr("opacity", 1)
                    .attr("stroke-width", 4);
                
                const source = nodes.find(n => n.id === d.source);
                const target = nodes.find(n => n.id === d.target);
                
                tooltip
                    .style("opacity", 1)
                    .html(`<strong>${source.name.replace('\n', ' ')}</strong> â†’ <strong>${target.name.replace('\n', ' ')}</strong><br/>Flow Strength: ${d.value}`);
            })
            .on("mousemove", function(event) {
                tooltip
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 10) + "px");
            })
            .on("mouseout", function() {
                d3.select(this)
                    .attr("opacity", 0.5)
                    .attr("stroke-width", 2);
                tooltip.style("opacity", 0);
            });

        // Draw nodes
        const node = svg.append("g")
            .selectAll("circle")
            .data(nodes)
            .join("circle")
            .attr("class", "node-circle")
            .attr("cx", d => d.x)
            .attr("cy", d => d.y)
            .attr("r", 10)
            .attr("fill", d => d.color)
            .on("mouseover", function(event, d) {
                d3.select(this).attr("r", 14);
                
                // Highlight connected links
                link.attr("opacity", l => {
                    return (l.source === d.id || l.target === d.id) ? 1 : 0.15;
                }).attr("stroke-width", l => {
                    return (l.source === d.id || l.target === d.id) ? 4 : 2;
                });
                
                tooltip
                    .style("opacity", 1)
                    .html(`<strong>${d.name.replace('\n', ' ')}</strong><br/>Layer: ${d.layer}<br/>Component Type: ${d.color === '#FFB84D' ? 'Algorithm' : d.color === '#9D4EDD' ? 'Data Source' : d.color === '#FF6B9D' ? 'Processing' : d.color === '#B490FF' ? 'Visualization' : d.color === '#FF8C42' ? 'Alert' : 'Logic Layer'}`);
            })
            .on("mousemove", function(event) {
                tooltip
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 10) + "px");
            })
            .on("mouseout", function() {
                d3.select(this).attr("r", 10);
                link.attr("opacity", 0.5).attr("stroke-width", 2);
                tooltip.style("opacity", 0);
            });

        // Draw labels
        const labels = svg.append("g")
            .selectAll("text")
            .data(nodes)
            .join("text")
            .attr("class", "node-label")
            .attr("x", d => d.x)
            .attr("y", d => d.y + 30)
            .selectAll("tspan")
            .data(d => d.name.split('\n').map(line => ({ text: line, x: d.x, y: d.y })))
            .join("tspan")
            .attr("x", d => d.x)
            .attr("dy", (d, i) => i === 0 ? 0 : "1.2em")
            .text(d => d.text);
    </script>
</body>
</html>