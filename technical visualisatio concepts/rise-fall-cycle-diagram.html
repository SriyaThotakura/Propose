<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mathematical Cycle of Rise & Fall</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        :root {
            --bg: #050608;
            --bg-soft: #111318;
            --text-main: #F5F5F2;
            --text-muted: #A5A7B4;
            --accent-feral: #FF3B4A;
            --accent-alert: #F9C74F;
            --accent-repair: #3EDFA4;
            --accent-link: #6BA7FF;
            --divider-strong: #F5F5F2;
            --divider-soft: #3A3D47;
            --shadow-subtle: rgba(0, 0, 0, 0.45);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: var(--bg);
            color: var(--text-main);
            overflow-x: hidden;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            padding: 40px 20px;
            border-bottom: 2px solid var(--divider-strong);
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5em;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 15px;
            text-shadow: 0 0 20px var(--accent-feral);
        }

        .header .subtitle {
            color: var(--accent-alert);
            font-size: 1.1em;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .ascii-divider {
            text-align: center;
            color: var(--divider-strong);
            font-size: 0.8em;
            margin: 30px 0;
            letter-spacing: 2px;
        }

        svg {
            display: block;
            margin: 0 auto;
            background: var(--bg-soft);
            border-radius: 4px;
            box-shadow: 0 8px 32px var(--shadow-subtle);
        }

        .phase-segment {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .phase-segment:hover {
            filter: brightness(1.2);
        }

        .phase-icon {
            font-size: 32px;
        }

        .phase-title {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 18px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .phase-description {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.6;
        }

        .center-label {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .agent-dot {
            transition: all 0.3s ease;
        }

        .building-icon {
            transition: all 0.3s ease;
        }

        .info-panel {
            background: var(--bg-soft);
            border: 2px solid var(--divider-soft);
            border-radius: 4px;
            padding: 30px;
            margin-top: 40px;
            box-shadow: 0 8px 32px var(--shadow-subtle);
        }

        .info-panel h3 {
            color: var(--accent-feral);
            font-size: 1.5em;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 2px solid var(--accent-feral);
            padding-bottom: 10px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .info-card {
            background: var(--bg);
            border: 1px solid var(--divider-soft);
            border-left: 4px solid var(--accent-feral);
            padding: 20px;
            border-radius: 4px;
        }

        .info-card.phase-1 {
            border-left-color: var(--accent-repair);
        }

        .info-card.phase-2 {
            border-left-color: var(--accent-alert);
        }

        .info-card.phase-3 {
            border-left-color: var(--accent-feral);
        }

        .info-card.phase-4 {
            border-left-color: var(--accent-link);
        }

        .info-card h4 {
            color: var(--accent-alert);
            margin-bottom: 10px;
            font-size: 1.1em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-card p {
            color: var(--text-main);
            line-height: 1.8;
            font-size: 0.95em;
        }

        .key-insight {
            background: var(--bg-soft);
            border: 2px solid var(--accent-alert);
            border-radius: 4px;
            padding: 20px;
            margin: 30px 0;
            text-align: center;
        }

        .key-insight strong {
            color: var(--accent-alert);
            font-size: 1.2em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .key-insight p {
            margin-top: 10px;
            color: var(--text-muted);
            line-height: 1.8;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-icon {
            font-size: 24px;
        }

        .legend-text {
            color: var(--text-muted);
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .cycle-arrow {
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .pulse {
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âŸ¨ THE MATHEMATICAL CYCLE OF RISE & FALL âŸ©</h1>
            <div class="subtitle">[ LIMIT CYCLE DYNAMICS // ABM VISUALIZATION ]</div>
        </div>

        <div class="ascii-divider">
            â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        </div>

        <svg id="cycle-diagram" width="1200" height="800"></svg>

        <div class="legend">
            <div class="legend-item">
                <span class="legend-icon">ğŸ‘¥</span>
                <span class="legend-text">Commoners</span>
            </div>
            <div class="legend-item">
                <span class="legend-icon">ğŸ‘‘</span>
                <span class="legend-text">Elites</span>
            </div>
            <div class="legend-item">
                <span class="legend-icon">ğŸ›ï¸</span>
                <span class="legend-text">State Infrastructure</span>
            </div>
        </div>

        <div class="key-insight">
            <strong>âš  THIS CYCLE IS A STABLE LOOP âš </strong>
            <p>Mathematically, this is a 'limit cycle'. External events like war may alter its speed, but the system always returns to this pattern.</p>
        </div>

        <div class="info-panel">
            <h3>[ PHASE BREAKDOWN ]</h3>
            <div class="info-grid">
                <div class="info-card phase-1">
                    <h4>// 01 :: GROWTH & PROSPERITY</h4>
                    <p>The commoner population grows, creating a resource surplus that fuels the expansion of an elite class and state wealth. Initial conditions are stable with low elite numbers and high resource availability.</p>
                </div>
                <div class="info-card phase-2">
                    <h4>// 02 :: ELITE OVERPRODUCTION</h4>
                    <p>The elite population grows too large for the available resources, creating intense competition for a shrinking pie. Resource extraction accelerates as elites compete for dominance.</p>
                </div>
                <div class="info-card phase-3">
                    <h4>// 03 :: STATE STRESS & FAILURE</h4>
                    <p>Elite infighting and a declining tax base from an overburdened commoner population eventually bankrupt the state. Institutional capacity collapses under the weight of competing demands.</p>
                </div>
                <div class="info-card phase-4">
                    <h4>// 04 :: COLLAPSE & RESET</h4>
                    <p>State failure causes elite numbers to plummet, which reduces pressure on commoners, allowing the cycle to begin anew. The system returns to low-complexity conditions.</p>
                </div>
            </div>
        </div>

        <div class="ascii-divider">
            â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        </div>

        <div class="info-panel">
            <h3>[ ABM CONNECTION ]</h3>
            <p style="color: var(--text-main); line-height: 2; margin-top: 15px;">
                This cycle can be simulated using <span style="color: var(--accent-feral); font-weight: bold;">Agent-Based Modeling</span>, where individual agents (commoners, elites) follow simple rules:
            </p>
            <ul style="color: var(--text-muted); line-height: 2; margin: 20px 0 20px 40px;">
                <li><span style="color: var(--accent-repair);">Commoners</span> consume resources to survive and reproduce</li>
                <li><span style="color: var(--accent-alert);">Elites</span> extract surplus from commoners through taxation</li>
                <li><span style="color: var(--accent-link);">State</span> requires tax revenue to maintain infrastructure</li>
                <li><span style="color: var(--accent-feral);">Resources</span> regenerate at a fixed rate</li>
            </ul>
            <p style="color: var(--text-main); line-height: 2;">
                The complex cyclical behavior <span style="color: var(--accent-alert); font-weight: bold;">emerges from these simple agent interactions</span>â€”no central controller required. This is the same principle used in the Feral Map to model 70 years of structural violence.
            </p>
        </div>
    </div>

    <script>
        const svg = d3.select('#cycle-diagram');
        const width = 1200;
        const height = 800;
        const centerX = width / 2;
        const centerY = height / 2;
        const radius = 280;

        // Define phases
        const phases = [
            {
                angle: 0,
                span: 90,
                title: '1. GROWTH &\nPROSPERITY',
                description: 'The commoner population\ngrows, creating a resource\nsurplus that fuels the\nexpansion of an elite\nclass and state wealth.',
                color: '#3EDFA4', // accent-repair
                icon: 'ğŸŒ±',
                commoners: 40,
                elites: 5,
                prosperity: 0.9
            },
            {
                angle: 90,
                span: 90,
                title: '2. ELITE\nOVERPRODUCTION',
                description: 'The elite population grows\ntoo large for the available\nresources, creating intense\ncompetition for a\nshrinking pie.',
                color: '#F9C74F', // accent-alert
                icon: 'âš¡',
                commoners: 45,
                elites: 20,
                prosperity: 0.6
            },
            {
                angle: 180,
                span: 90,
                title: '3. STATE STRESS\n& FAILURE',
                description: 'Elite infighting and a\ndeclining tax base from an\noverburdened commoner\npopulation eventually\nbankrupt the state.',
                color: '#FF3B4A', // accent-feral
                icon: 'ğŸ’¥',
                commoners: 30,
                elites: 18,
                prosperity: 0.3
            },
            {
                angle: 270,
                span: 90,
                title: '4. COLLAPSE\n& RESET',
                description: 'State failure causes elite\nnumbers to plummet, which\nreduces pressure on\ncommoners, allowing the\ncycle to begin anew.',
                color: '#6BA7FF', // accent-link
                icon: 'ğŸ”„',
                commoners: 25,
                elites: 3,
                prosperity: 0.5
            }
        ];

        // Create gradient definitions
        const defs = svg.append('defs');
        phases.forEach((phase, i) => {
            const gradient = defs.append('radialGradient')
                .attr('id', `gradient-${i}`);
            gradient.append('stop')
                .attr('offset', '0%')
                .attr('stop-color', phase.color)
                .attr('stop-opacity', 0.8);
            gradient.append('stop')
                .attr('offset', '100%')
                .attr('stop-color', phase.color)
                .attr('stop-opacity', 0.3);
        });

        // Draw phase segments
        phases.forEach((phase, i) => {
            const startAngle = (phase.angle - 90) * Math.PI / 180;
            const endAngle = ((phase.angle + phase.span) - 90) * Math.PI / 180;
            
            const arc = d3.arc()
                .innerRadius(radius - 80)
                .outerRadius(radius + 40)
                .startAngle(startAngle)
                .endAngle(endAngle);

            const g = svg.append('g')
                .attr('class', 'phase-segment')
                .attr('transform', `translate(${centerX}, ${centerY})`);

            // Arc segment
            g.append('path')
                .attr('d', arc)
                .attr('fill', `url(#gradient-${i})`)
                .attr('stroke', phase.color)
                .attr('stroke-width', 2)
                .attr('opacity', 0.8);

            // Phase icon
            const iconAngle = (phase.angle + phase.span / 2 - 90) * Math.PI / 180;
            const iconRadius = radius - 30;
            const iconX = Math.cos(iconAngle) * iconRadius;
            const iconY = Math.sin(iconAngle) * iconRadius;

            g.append('text')
                .attr('class', 'phase-icon')
                .attr('x', iconX)
                .attr('y', iconY)
                .attr('text-anchor', 'middle')
                .attr('dominant-baseline', 'middle')
                .attr('font-size', '40px')
                .text(phase.icon);

            // Phase title
            const titleAngle = (phase.angle + phase.span / 2 - 90) * Math.PI / 180;
            const titleRadius = radius + 100;
            const titleX = Math.cos(titleAngle) * titleRadius;
            const titleY = Math.sin(titleAngle) * titleRadius;

            phase.title.split('\n').forEach((line, lineIdx) => {
                g.append('text')
                    .attr('class', 'phase-title')
                    .attr('x', titleX)
                    .attr('y', titleY + lineIdx * 20)
                    .attr('text-anchor', 'middle')
                    .attr('fill', phase.color)
                    .text(line);
            });

            // Phase description
            const descAngle = (phase.angle + phase.span / 2 - 90) * Math.PI / 180;
            const descRadius = radius + 180;
            const descX = Math.cos(descAngle) * descRadius;
            const descY = Math.sin(descAngle) * descRadius;

            phase.description.split('\n').forEach((line, lineIdx) => {
                g.append('text')
                    .attr('class', 'phase-description')
                    .attr('x', descX)
                    .attr('y', descY + lineIdx * 14)
                    .attr('text-anchor', 'middle')
                    .attr('fill', '#A5A7B4')
                    .text(line);
            });

            // Draw agents for this phase
            const numCommoners = phase.commoners;
            const numElites = phase.elites;

            // Commoners (smaller dots)
            for (let j = 0; j < numCommoners; j++) {
                const agentAngle = (phase.angle + Math.random() * phase.span - 90) * Math.PI / 180;
                const agentRadius = radius - 60 + Math.random() * 40;
                const agentX = Math.cos(agentAngle) * agentRadius;
                const agentY = Math.sin(agentAngle) * agentRadius;

                g.append('circle')
                    .attr('class', 'agent-dot')
                    .attr('cx', agentX)
                    .attr('cy', agentY)
                    .attr('r', 2.5)
                    .attr('fill', '#3EDFA4')
                    .attr('opacity', 0.6);
            }

            // Elites (larger dots)
            for (let j = 0; j < numElites; j++) {
                const agentAngle = (phase.angle + Math.random() * phase.span - 90) * Math.PI / 180;
                const agentRadius = radius - 50 + Math.random() * 30;
                const agentX = Math.cos(agentAngle) * agentRadius;
                const agentY = Math.sin(agentAngle) * agentRadius;

                g.append('circle')
                    .attr('class', 'agent-dot')
                    .attr('cx', agentX)
                    .attr('cy', agentY)
                    .attr('r', 4)
                    .attr('fill', '#F9C74F')
                    .attr('opacity', 0.8);
            }

            // Building/state icon
            const buildingAngle = (phase.angle + phase.span / 2 - 90) * Math.PI / 180;
            const buildingRadius = radius + 20;
            const buildingX = Math.cos(buildingAngle) * buildingRadius;
            const buildingY = Math.sin(buildingAngle) * buildingRadius;

            g.append('text')
                .attr('class', 'building-icon')
                .attr('x', buildingX)
                .attr('y', buildingY)
                .attr('text-anchor', 'middle')
                .attr('dominant-baseline', 'middle')
                .attr('font-size', '24px')
                .attr('opacity', phase.prosperity)
                .text('ğŸ›ï¸');
        });

        // Center circle with label
        const centerG = svg.append('g')
            .attr('transform', `translate(${centerX}, ${centerY})`);

        centerG.append('circle')
            .attr('r', radius - 90)
            .attr('fill', '#111318')
            .attr('stroke', '#F5F5F2')
            .attr('stroke-width', 3)
            .attr('opacity', 0.9);

        centerG.append('text')
            .attr('class', 'center-label')
            .attr('y', -30)
            .attr('text-anchor', 'middle')
            .attr('font-size', '18px')
            .attr('fill', '#F9C74F')
            .text('THIS CYCLE IS');

        centerG.append('text')
            .attr('class', 'center-label')
            .attr('y', -5)
            .attr('text-anchor', 'middle')
            .attr('font-size', '20px')
            .attr('fill', '#FF3B4A')
            .text('A STABLE LOOP');

        centerG.append('text')
            .attr('class', 'center-label')
            .attr('y', 25)
            .attr('text-anchor', 'middle')
            .attr('font-size', '11px')
            .attr('fill', '#A5A7B4')
            .text('Mathematically, this is');

        centerG.append('text')
            .attr('class', 'center-label')
            .attr('y', 40)
            .attr('text-anchor', 'middle')
            .attr('font-size', '11px')
            .attr('fill', '#A5A7B4')
            .text("a 'limit cycle'.");

        centerG.append('text')
            .attr('class', 'center-label')
            .attr('y', 65)
            .attr('text-anchor', 'middle')
            .attr('font-size', '10px')
            .attr('fill', '#A5A7B4')
            .text('External events like war');

        centerG.append('text')
            .attr('class', 'center-label')
            .attr('y', 78)
            .attr('text-anchor', 'middle')
            .attr('font-size', '10px')
            .attr('fill', '#A5A7B4')
            .text('may alter its speed,');

        centerG.append('text')
            .attr('class', 'center-label')
            .attr('y', 91)
            .attr('text-anchor', 'middle')
            .attr('font-size', '10px')
            .attr('fill', '#A5A7B4')
            .text('but the system always');

        centerG.append('text')
            .attr('class', 'center-label')
            .attr('y', 104)
            .attr('text-anchor', 'middle')
            .attr('font-size', '10px')
            .attr('fill', '#A5A7B4')
            .text('returns to this pattern.');

        // Circular arrows indicating cycle direction
        const arrowRadius = radius + 60;
        for (let i = 0; i < 4; i++) {
            const angle = (i * 90 + 45 - 90) * Math.PI / 180;
            const x = Math.cos(angle) * arrowRadius;
            const y = Math.sin(angle) * arrowRadius;

            centerG.append('text')
                .attr('x', x)
                .attr('y', y)
                .attr('text-anchor', 'middle')
                .attr('dominant-baseline', 'middle')
                .attr('font-size', '24px')
                .attr('fill', '#FF3B4A')
                .attr('class', 'pulse')
                .text('â†’');
        }
    </script>
</body>
</html>